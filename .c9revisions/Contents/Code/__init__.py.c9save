{"ts":1371485395299,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"TITLE = '4tube'\nART = 'art-default.jpg'\nICON = 'icon-default.png'\nBASE_URL = 'http://www.4tube.com'\n\nALL_VIDEOS_URL = '%s/videos/data?subListAction=&sort=%%s&page=%%%%d' % BASE_URL\nPORNSTARS_AZ_URL = '%s/pornstars/%%s?sort=%%s&page=%%%%d' % BASE_URL\nPORNSTAR_URL = '%s/pornstars/%%s?sort=%%s&page=%%%%d' % BASE_URL\nTAGS_URL = '%s/find/tags/%%s?data=1&sort=%%s&page=%%%%d' % BASE_URL\n\nRE_DURATION = Regex('(\\d+)min (\\d+)sec')\n\n####################################################################################################\ndef Start():\n\n\tPlugin.AddViewGroup('List', viewMode='List', mediaType='items')\n\tPlugin.AddViewGroup('InfoList', viewMode='InfoList', mediaType='items')\n\n\tObjectContainer.title1 = TITLE\n\tObjectContainer.art = R(ART)\n\tDirectoryObject.thumb = R(ICON)\n\tNextPageObject.thumb = R(ICON)\n\n\tHTTP.CacheTime = CACHE_1HOUR\n\tHTTP.Headers['User-Agent'] = 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.8; rv:21.0) Gecko/20100101 Firefox/21.0'\n\n####################################################################################################\n@handler('/video/4tube', TITLE, art=ART, thumb=ICON)\ndef MainMenu():\n\n\toc = ObjectContainer(view_group='List')\n\n\toc.add(DirectoryObject(key=Callback(BrowseAllVideos, title='Browse All Videos'), title='Browse All Videos'))\n\toc.add(DirectoryObject(key=Callback(PornstarsAZ, title='Pornstars A-Z'), title='Pornstars A-Z'))\n\toc.add(DirectoryObject(key=Callback(MostPopularTags, title='Most Popular Tags'), title='Most Popular Tags'))\n\toc.add(PrefsObject(title='Preferences', thumb=R('icon-prefs.png')))\n\n\treturn oc\n\n####################################################################################################\n@route('/video/4tube/videos/all')\ndef BrowseAllVideos(title):\n\n\turl = ALL_VIDEOS_URL % Prefs['sort_video']\n\treturn GetVideos(url, title=title)\n\n####################################################################################################\n@route('/video/4tube/pornstars/alphabetically')\ndef PornstarsAZ(title):\n\n\toc = ObjectContainer(title2=title, view_group='List')\n\n\tfor char in list(String.UPPERCASE):\n\t\toc.add(DirectoryObject(\n\t\t\tkey = Callback(Pornstars, char=char),\n\t\t\ttitle = char\n\t\t))\n\n\treturn oc\n\n####################################################################################################\n@route('/video/4tube/pornstars/{char}')\ndef Pornstars(char):\n\n\toc = ObjectContainer(title2=char, view_group='List')\n\turl = PORNSTARS_AZ_URL % (char, Prefs['sort_pornstar'])\n\n\t# Get the number of pages\n\tpages = HTML.ElementFromURL(url % 1, cacheTime=CACHE_1WEEK).xpath('//span[@class=\"pagination\"]')\n\n\tif len(pages) < 1:\n\t\tpages = 1\n\telse:\n\t\tpages = pages[0].xpath('./a[last()]')[0].get('href')\n\t\tpages = int(pages.split('page=')[-1])\n\n\t# Loop over all the pages to grab all pornstar names and info\n\tfor i in range (1, pages+1):\n\t\tpornstars = HTML.ElementFromURL(url % i, cacheTime=CACHE_1WEEK).xpath('//div[@class=\"pornstarInfo_large\"]')\n\n\t\tfor p in pornstars:\n\t\t\tname = p.xpath('./span[contains(@class, \"pornstar\")]/a/text()')[0].strip()\n\t\t\tthumb = p.xpath('./a/img/@src')[0].replace('/161x161.jpeg', '/300x300.jpeg')\n\n\t\t\toc.add(DirectoryObject(\n\t\t\t\tkey = Callback(Pornstar, name=name, url_name=name.lower().replace(' ', '-')),\n\t\t\t\ttitle = name,\n\t\t\t\tthumb = Resource.ContentsOfURLWithFallback(url=thumb, fallback=ICON)\n\t\t\t))\n\n\treturn oc\n\n####################################################################################################\n@route('/video/4tube/pornstar/{url_name}/videos')\ndef Pornstar(name, url_name):\n\n\turl = PORNSTAR_URL % (url_name, Prefs['sort_video'])\n\treturn GetVideos(url, title=name)\n\n####################################################################################################\n@route('/video/4tube/tags')\ndef MostPopularTags(title):\n\n\toc = ObjectContainer(title2=title, view_group='List')\n\ttags = HTML.ElementFromURL(BASE_URL).xpath('//div[@class=\"tags\"]//a[text()!=\"\"]')\n\n\tfor t in tags:\n\t\ttitle = t.text.strip().title()\n\t\ttag = t.get('href').split('/')[-1]\n\n\t\toc.add(DirectoryObject(\n\t\t\tkey = Callback(Tag, title=title, tag=tag),\n\t\t\ttitle = title\n\t\t))\n\n\treturn oc\n\n####################################################################################################\n@route('/video/4tube/tag/{tag}')\ndef Tag(title, tag):\n\n\turl = TAGS_URL % (tag, Prefs['sort_video'])\n\treturn GetVideos(url, title=title)\n\n####################################################################################################\n@route('/video/4tube/videos', page=int)\ndef GetVideos(url, title, page=1):\n\n\toc = ObjectContainer(title2=title, view_group='InfoList')\n\thtml = HTML.ElementFromURL(url % page)\n\tvideos = html.xpath('//div[@class=\"videoInfo\"]')\n\n\tfor v in videos:\n\t\tname = v.xpath('./span[contains(@class, \"pornstar\")]/a/strong/text()')[0].strip()\n\t\tvideo_url = v.xpath('./a/@href')[0]\n\t\tthumb = v.xpath('./a/img/@src')[0].replace('/160x120/', '/320x240/')\n\t\tsummary = v.xpath('./a/img[@class=\"thumb\"]/@title')[0].strip()\n\t\tduration = v.xpath('./span[@class=\"info\"]/span[@class=\"length\"]/text()')[0]\n\t\tduration = TimeToMs(duration)\n\t\trating = v.xpath('./span[@class=\"info\"]/span[@class=\"rating\"]//span[@class=\"full\"]')\n\t\trating = float(len(rating) * 2)\n\n\t\toc.add(VideoClipObject(\n\t\t\turl = video_url,\n\t\t\ttitle = name,\n\t\t\tsummary = summary,\n\t\t\tduration = duration,\n\t\t\trating = rating,\n\t\t\tthumb = Resource.ContentsOfURLWithFallback(url=thumb, fallback=ICON)\n\t\t))\n\n\t# Next page\n\tpages = html.xpath('//span[@class=\"pagination\"]')\n\n\tif len(pages) < 1:\n\t\tpages = 1\n\telse:\n\t\tpages = pages[0].xpath('./a[last()]')[0].get('href')\n\t\tpages = int(pages.split('page=')[-1])\n\n\tif page < pages:\n\t\toc.add(NextPageObject(\n\t\t\tkey = Callback(GetVideos, title=title, url=url, page=page+1),\n\t\t\ttitle = L('More...')\n\t\t))\n\n\treturn oc\n\n####################################################################################################\ndef TimeToMs(timecode):\n\n\tseconds = 0\n\tduration = list(RE_DURATION.findall(timecode)[0])\n\tduration.reverse()\n\n\tfor i in range(0, len(duration)):\n\t\tseconds += int(duration[i]) * (60**i)\n\n\treturn seconds * 1000\n"]],"start1":0,"start2":0,"length1":0,"length2":6022}]],"length":6022}
{"contributors":[],"silentsave":true,"ts":1371485305534,"patch":[[{"diffs":[[0,"efault.p"],[-1,"n"],[0,"g'\nBASE_"]],"start1":54,"start2":54,"length1":17,"length2":16}]],"length":6021,"saved":false}
{"ts":1371485306517,"patch":[[{"diffs":[[0,"default."],[1,"j"],[0,"pg'\nBASE"]],"start1":53,"start2":53,"length1":16,"length2":17}]],"length":6022,"saved":false}
